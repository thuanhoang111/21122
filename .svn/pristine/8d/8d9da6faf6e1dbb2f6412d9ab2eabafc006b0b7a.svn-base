import { View } from "react-native";
import * as constantMain from "../../constants/ConstantMain";
import {
  VStack,
  Heading,
  ScrollView,
  Center,
  HStack,
  Skeleton,
} from "native-base";

import * as Get from "../../API/service/Get";
import { useEffect, useLayoutEffect, useState } from "react";
import DataTableMain_2 from "./../../components/DataTable/DataTableMain_2";
import { financialReportName } from "../../model/data";
import { useToggle } from "@uidotdev/usehooks";
function FinancialReport({ route, navigation }) {
  const [listFinancialReport, setListFinancialReport] = useState([]);
  const [isRender, setIsRender] = useToggle(false);
  const dataUser = route.params.data;
  const inforFilter = route.params.inforFilter;
  /**
   * Author:ThuanHoang 25/06/2023
   * Function handle get data Financial Report 
   */
  const getInfoReport = async () => {
    await Get.getWithParam(
      "FinancialReport",
      inforFilter
        ? `m1=${inforFilter.startMonth}&m2=${inforFilter.endMonth}&userId=${dataUser.id}&year=${inforFilter.year}`
        : `m1=1&m2=12&userId=${dataUser.id}&year=${
            dataUser.permission[dataUser.permission.length - 1].year
          }`
    ).then((res) => {
      setListFinancialReport(res[0].FinancialDetails);
    });
  };
  useEffect(() => {
    setTimeout(() => {
      setIsRender(true);
    }, 1);
    getInfoReport();
  }, []);
  return (
    <View
      style={{
        width: constantMain.widthOfScreen,
        display: "flex",
        flexDirection: "column",
      }}
    >
      <VStack space={1} alignItems="center" marginY={2}>
        {listFinancialReport.length !== 0 ? (
          <>
            <Heading fontSize="xl">
              {` Năm ${
                inforFilter
                  ? inforFilter.year
                  : dataUser.permission[dataUser.permission.length - 1].year
              }`}
            </Heading>
            <Heading fontSize="md" fontWeight={400}>
              Thông tư 24/2017/TT-BTC
            </Heading>
          </>
        ) : (
          isRender && (
            <>
              <Skeleton.Text lines={1} w={"35%"}></Skeleton.Text>
              <Skeleton.Text lines={1} w={"70%"}></Skeleton.Text>
            </>
          )
        )}
      </VStack>

      {listFinancialReport.length !== 0 ? (
        <ScrollView style={{ marginBottom: 70 }} nestedScrollEnabled={true}>
          <DataTableMain_2
            fields={["Tài Sản"]}
            data={listFinancialReport.slice(0, 9)}
            listTitle={financialReportName.slice(0, 9)}
          ></DataTableMain_2>
          <DataTableMain_2
            fields={["Nguồn vốn"]}
            data={listFinancialReport.slice(9)}
            listTitle={financialReportName.slice(9)}
          ></DataTableMain_2>
        </ScrollView>
      ) : (
        <ScrollView style={{ height: "92%" }}>
          {isRender && (
            <>
              <Center
                w="97%"
                style={{
                  borderRadius: 25,
                  zIndex: 100,
                  marginTop: 20,
                  marginHorizontal: 5,
                }}
              >
                <HStack
                  w="100%"
                  maxW="400"
                  space={10}
                  rounded="3xl"
                  alignItems="center"
                  p={3}
                  style={{
                    backgroundColor: "#b8c0c2",
                    borderBottomRightRadius: 0,
                    borderBottomLeftRadius: 0,
                  }}
                >
                  <HStack flex="2" space="8">
                    <Skeleton.Text w={"100%"} lines={1} />
                  </HStack>
                </HStack>
                <HStack
                  w={"100%"}
                  maxW="400"
                  rounded={"3xl"}
                  marginTop={1}
                  alignItems="center"
                  p={4}
                >
                  <HStack flex="2" space="6">
                    <Skeleton w={"100%"} h={300} lines={1} />
                  </HStack>
                </HStack>
                <HStack
                  w={"100%"}
                  maxW="400"
                  rounded={"3xl"}
                  marginTop={1}
                  alignItems="center"
                  style={{
                    backgroundColor: "#b8c0c2",
                    borderTopRightRadius: 0,
                    borderTopLeftRadius: 0,
                  }}
                  p={4}
                >
                  <HStack flex="2" space="6">
                    <Skeleton.Text w={"100%"} lines={1} />
                  </HStack>
                </HStack>
              </Center>
              <Center
                w="97%"
                style={{
                  borderRadius: 25,
                  zIndex: 100,
                  marginTop: 20,
                  marginHorizontal: 5,
                }}
              >
                <HStack
                  w="100%"
                  maxW="400"
                  space={10}
                  rounded="3xl"
                  alignItems="center"
                  p={3}
                  style={{
                    backgroundColor: "#b8c0c2",
                    borderBottomRightRadius: 0,
                    borderBottomLeftRadius: 0,
                  }}
                >
                  <HStack flex="2" space="8">
                    <Skeleton.Text w={"100%"} lines={1} />
                  </HStack>
                </HStack>
                <HStack
                  w={"100%"}
                  maxW="400"
                  rounded={"3xl"}
                  marginTop={1}
                  alignItems="center"
                  p={4}
                >
                  <HStack flex="2" space="6">
                    <Skeleton w={"100%"} h={300} lines={1} />
                  </HStack>
                </HStack>
                <HStack
                  w={"100%"}
                  maxW="400"
                  rounded={"3xl"}
                  marginTop={1}
                  alignItems="center"
                  style={{
                    backgroundColor: "#b8c0c2",
                    borderTopRightRadius: 0,
                    borderTopLeftRadius: 0,
                  }}
                  p={4}
                >
                  <HStack flex="2" space="6">
                    <Skeleton.Text w={"100%"} lines={1} />
                  </HStack>
                </HStack>
              </Center>
            </>
          )}
        </ScrollView>
      )}
    </View>
  );
}

export default FinancialReport;
